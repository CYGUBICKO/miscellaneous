---
title: 'Organise Variables in a dataframe'
author: "Steve Cygu ([cygubicko@gmail.com](mailto:cygubicko@gmail.com))"
date: "2019 Feb 25 (Mon)"
output:
  html_document:
   code_folding: show
   number_sections: yes
   toc: yes
   toc_depth: 5
   toc_float: yes
---

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE
	, warning = FALSE
	, message = FALSE
	, fig.width = 10
	, fig.height = 10
	, results = "asis")
options(width = 12)
```

# Setup

We begin by loading the required packages. If you don't have the packages installed, use `install.packages("package_name")`.

```{r, echo = TRUE}
library(DT)
library(dplyr)
library(tidyr)
```


# Problem

By default R appends any newly created variable at the end of the dataset. However, at time, we want to organise our dataset such that related variables (maybe by naming structure) follow each other or are in some kind of nest. This might not necessarily improve ease-to-analyse but it does improve human readerability and to some extent improve ease-to-manipulate. In some other cases, variable re(ordering) or organisation maybe necessitated by client request. 

In this [post](https://cygubicko.github.io/miscellaneous/separate_entries.html), I wanted to make sure that variables which counted the number of selections per case was either created before the separated variables or followed immedialy after the split. I thought I could easily specify that in `mutate()` function or find some help online but here we are trying to figure it out together.

In this post we implement a simple function that will help us accomplish the above tasks. In addition, to apply it to a datset, we use [social media survey data](https://github.com/CYGUBICKO/miscellaneous/tree/master/datasets) described in this [post](https://cygubicko.github.io/miscellaneous/separate_entries.html).

```{r}
desc <- read.csv("../datasets/multi_resp_desc.csv")
datatable(desc, rownames = FALSE)
```


```{r}

organiseVars <- function(df, move_vars, after = NULL, before = NULL){
  
  if(is.null(after) & is.null(before)){
    stop("You can not organise variables without specifying where to move them.")
  }
  
  if (sum(after %in% move_vars) > 0 | sum(before %in% move_vars) > 0){
    stop("You cannot move a variable within itself.")
  }
  
  varnames <- colnames(df)
  temp_varnames <- setdiff(varnames, move_vars)
  if(is.null(after)){
    new_order <- c(move_vars, temp_varnames)
  }
  
  if(is.null(before)){
    new_order <- c(temp_varnames, move_vars)
  }
  
  if(!is.null(after) & !is.null(before)){
    left_indices <- c(match(first(temp_varnames), temp_varnames):match(after, temp_varnames))
    left_vars <- varnames[left_indices]
    right_indices <- c(match(before, temp_varnames):match(last(temp_varnames), temp_varnames))
    right_vars <- varnames[right_indices]
    new_order <- c(left_vars, move_vars, right_vars)
  }
  
  df <- (df
    %>% select(new_order)
  )
  return(df)
}


```


```{r}
mydata <- read.csv("../datasets/multi_response.csv")
mydata <-(mydata
  %>% organiseVars("smedia_used", "doi", before = NULL)
)
```


You can download the function from [here](https://github.com/CYGUBICKO/miscellaneous/tree/master/funs) or markdown file from [here](https://github.com/CYGUBICKO/miscellaneous/tree/master/data_mgt).
